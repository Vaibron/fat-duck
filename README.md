# Система бронирования ресторана

Веб-приложение на Django для управления бронированием столиков и заказами в ресторане. Это современное решение с элегантным дизайном и функциональностью, позволяющее пользователям бронировать столики, просматривать меню и управлять своими заказами, а администраторам — полностью контролировать систему.

## Описание проекта

Система бронирования и управления заказами для ресторана, разработанная с использованием Django 5.1.7. Проект включает:
- Бронирование столиков с проверкой доступности (1–20 столов, время работы 8:00–22:00).
- Управление заказами с выбором блюд из меню, разбитого по категориям.
- Личный кабинет для пользователей и расширенный интерфейс для администраторов.
- Адаптивный дизайн с использованием Bootstrap 4.5.2, Font Awesome и Flatpickr для выбора даты/времени.

Текущая версия использует SQLite для разработки, но может быть адаптирована для продакшена с PostgreSQL или другой базой данных.

---

## Требования

- Python 3.8+
- Django 5.1.7
- SQLite (по умолчанию) или PostgreSQL/MySQL для продакшена
- Docker (опционально, для контейнеризации)
- Установленные зависимости (см. `requirements.txt`)

---

## Установка

### Локальная установка
1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/username/fat-duck.git
   cd fat-duck
   ```

2. **Создайте виртуальное окружение:**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   venv\Scripts\activate     # Windows
   ```

3. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Примените миграции:**
   ```bash
   python manage.py makemigrations
   python manage.py migrate
   ```

5. **Уже имеется суперпользователь (Логин - admin , пароль - 59818692) Если необходимо создайте своего суперпользователя:**
   ```bash
   python manage.py createsuperuser
   ```

6. **Запустите сервер:**
   ```bash
   python manage.py runserver
   ```
   Приложение доступно по адресу `http://127.0.0.1:8000/`.


## Структура проекта

```
fat-duck/
├── base/                    # Основное приложение
│   ├── templates/           # Базовые шаблоны
│   │   ├── about.html       # Страница "О нас"
│   │   ├── base.html        # Основной шаблон с навигацией и футером
│   │   ├── contacts.html    # Страница контактов
│   │   ├── home.html        # Главная страница
│   │   ├── menu.html        # Страница меню с поиском и категориями
│   │   ├── privacy_policy.html # Политика конфиденциальности
│   │   └── terms.html       # Условия использования
│   ├── __init__.py          # Пустой файл инициализации
│   ├── asgi.py              # Конфигурация ASGI для асинхронного сервера
│   ├── settings.py          # Основные настройки проекта (база данных, приложения, пути)
│   ├── urls.py              # Главные маршруты проекта
│   ├── views.py             # Общие представления (главная, меню, контакты и др.)
│   └── wsgi.py              # Конфигурация WSGI для синхронного сервера
├── bookings/                # Приложение для бронирования
│   ├── migrations/          # Миграции базы данных
│   │   ├── 0001_initial.py  # Начальная миграция модели Booking
│   │   └── __init__.py      # Пустой файл инициализации
│   ├── templates/           # Шаблоны для бронирования
│   │   ├── booking_list.html # Список бронирований (все для админа, свои для пользователя)
│   │   ├── book_table.html  # Форма бронирования столика
│   │   └── edit_booking.html # Редактирование бронирования и заказа
│   ├── __init__.py          # Пустой файл инициализации
│   ├── admin.py             # Регистрация модели Booking в админке
│   ├── apps.py              # Конфигурация приложения Bookings
│   ├── forms.py             # Форма BookingForm для бронирования и заказов
│   ├── models.py            # Модель Booking (стол, дата, пользователь, заказ)
│   ├── tests.py             # Заготовка для тестов (пока пустая)
│   ├── urls.py              # Маршруты приложения (список, редактирование, отмена)
│   └── views.py             # Представления для управления бронированиями
├── orders/                  # Приложение для заказов
│   ├── templates/           # Шаблоны для заказов
│   │   ├── analytics.html   # Аналитика заказов (выручка, популярные блюда)
│   │   └── order_detail.html # Подробности конкретного заказа
│   └── models.py            # Модели Order, MenuItem, OrderItem, Category
├── manage.py                # Скрипт управления Django
├── staticfiles/             # Собранные статические файлы (для продакшена)
├── media/                   # Медиафайлы (например, изображения блюд)
├── Dockerfile               # Файл для контейнеризации (см. ниже)
└── requirements.txt         # Список зависимостей
```

### Описание файлов
- **`manage.py`**: Точка входа для управления проектом (миграции, запуск сервера и др.).
- **`base/`**: Основное приложение с настройками и общими страницами.
  - `settings.py`: Настройки (база данных SQLite, `DEBUG = True`, пути к медиа/статике).
  - `urls.py`: Главные маршруты, включая подключение `bookings/` и `orders/`.
  - `views.py`: Представления для страниц "Главная", "Меню", "О нас", "Контакты".
  - `templates/`:
    - `base.html`: Шаблон с навигацией (меню, логин, кабинет) и футером.
    - `home.html`: Главная страница с описанием ресторана и призывом к бронированию.
    - `menu.html`: Отображение меню с фильтрацией и поиском.
    - Другие шаблоны: Информационные страницы с красивым дизайном.
- **`bookings/`**: Приложение для бронирования.
  - `models.py`: Модель `Booking` с полями: пользователь, номер стола, дата, заказ и др.
  - `forms.py`: `BookingForm` с валидацией (столы 1–20, время 8:00–22:00) и динамическими полями для блюд.
  - `views.py`: Логика отображения списка, редактирования, отмены и создания бронирований.
  - `templates/`: Шаблоны с Flatpickr для выбора даты и стилизованными формами.
  - `admin.py`: Настройки админ-панели для модели `Booking`.
  - `urls.py`: Маршруты для списка, редактирования, отмены и создания бронирований.
- **`orders/`**: Приложение для заказов.
  - `models.py`: Модели для заказов (`Order`), позиций (`OrderItem`), меню (`MenuItem`) и категорий (`Category`).
  - `templates/`: Шаблоны для аналитики и деталей заказа.

---

## Возможности администратора

Администратор (пользователь с `is_staff` или `is_superuser`) имеет расширенные права по сравнению с обычным пользователем. Вот детальное описание:

### 1. Кастомный интерфейс (ЛК админа в приложении)
- **Просмотр всех бронирований**:
  - Доступ: `/bookings/`.
  - Отображает все активные бронирования (`Booking.objects.filter(is_active=True)`).
  - Колонки: ID, номер стола, дата/время, заказ, действия (редактировать/отменить).
  - Шаблон: `booking_list.html` с заголовком "Все бронирования".
- **Редактирование бронирований**:
  - Доступ: `/bookings/edit/<booking_id>/`.
  - Может редактировать любое бронирование (стол, дату, заказ).
  - Ограничение: Нельзя редактировать после начала брони (`booking_date < now()`).
  - Формы: `BookingForm` для брони и `OrderEditForm` для заказа.
- **Отмена бронирований**:
  - Доступ: `/bookings/cancel/<booking_id>/`.
  - Отмена любого бронирования (`is_active = False`), удаление связанного заказа.
  - Ограничение: Нельзя отменить после начала.
- **Создание заказов**:
  - Добавление или редактирование заказов к любому бронированию через `edit_booking.html`.

### 2. Админ-панель Django (`/admin/`)
- **Управление бронированиями**:
  - Просмотр, создание, редактирование, удаление записей `Booking`.
  - Фильтры: `is_active`, `booking_date`.
  - Поиск: по имени пользователя и номеру стола.
- **Управление пользователями**:
  - Создание, редактирование, удаление пользователей (`auth.User`).
  - Назначение прав `is_staff` и `is_superuser`.
- **Управление заказами и меню**:
  - Возможность добавить модели `Order`, `MenuItem`, `Category` в `orders/admin.py` для полного контроля.
- **Полный доступ**:
  - Прямое взаимодействие с базой данных через интерфейс админки.

### Сравнение с пользователем
| Функция                  | Администратор                     | Пользователь                     |
|--------------------------|-----------------------------------|----------------------------------|
| Просмотр бронирований    | Все активные                     | Только свои                     |
| Редактирование           | Любое бронирование               | Только своё                     |
| Отмена                   | Любое бронирование               | Только своё                     |
| Создание брони           | Через админку или интерфейс      | Только через `/book/`           |
| Управление заказами      | Полное (добавление, удаление)    | Только добавление к своему      |
| Доступ к админке         | Полный                           | Нет                             |

---

## Dockerfile

В проекте имеется следующий файл `Dockerfile` он служит для контейнеризации:

```dockerfile
# Используем официальный образ Python
FROM python:3.11-slim

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем зависимости
COPY requirements.txt .

# Устанавливаем зависимости
RUN pip install --no-cache-dir -r requirements.txt

# Копируем весь проект
COPY . .

# Применяем миграции и собираем статику
RUN python manage.py makemigrations
RUN python manage.py migrate
RUN python manage.py collectstatic --noinput

# Указываем порт
EXPOSE 8000

# Команда для запуска приложения
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
```
### Использование Docker
1. **Используйте `Dockerfile` (см. ниже) в корень проекта.**
2. **Соберите образ:**
   ```bash
   docker build -t fat-duck .
   ```
3. **Запустите контейнер:**
   ```bash
   docker run -d -p 8000:8000 --name fat-duck-app fat-duck
   ```
4. **Создайте суперпользователя в контейнере:**
   ```bash
   docker exec -it fat-duck-app python manage.py createsuperuser
   ```
5. Откройте браузер: `http://localhost:8000/`.

---

### Примечания к Dockerfile
- Использует Python 3.9 slim для уменьшения размера образа.
- Устанавливает зависимости из `requirements.txt`.
- Выполняет миграции и сборку статических файлов при сборке.
- Запускает сервер на порту 8000.

---

## Основные функции

- **Главная**: Приветствие и информация о ресторане (`/`, `home.html`).
- **Меню**: Просмотр блюд с фильтрацией и поиском (`/menu/`).
- **Бронирование**: Выбор стола и времени (`/bookings/book/`).
- **ЛК пользователя**: Управление своими бронированиями (`/bookings/`).
- **ЛК админа**: Полный контроль над системой.

## Настройки для продакшена

- Установите `DEBUG = False` в `settings.py`.
- Обновите `ALLOWED_HOSTS` для вашего домена.
- Используйте безопасный `SECRET_KEY`.
- Настройте Nginx для статических и медиафайлов.
- Перейдите на PostgreSQL:
  ```python
  DATABASES = {
      'default': {
          'ENGINE': 'django.db.backends.postgresql',
          'NAME': 'fat_duck',
          'USER': 'admin',
          'PASSWORD': 'password',
          'HOST': 'localhost',
          'PORT': '5432',
      }
  }
  ```

## Текущий статус

- Дата: 14 марта 2025 года.
- Проект в разработке, тесты в папке tests/

## Контакты

- Email: [cafe@uytnyugolok.ru](mailto:cafe@uytnyugolok.ru)
- Telegram: [t.me/cafe_uytny_ugolok](https://t.me/cafe_uytny_ugolok)

